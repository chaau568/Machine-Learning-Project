{% extends "base.html" %} {% block title %}
<title>Number Classification Model</title>
<style>
  #canvas {
    border: 2px solid black;
    background-color: black;
    cursor: crosshair;
  }
</style>
{% endblock %} {% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-lg p-4">
        <div class="card-body text-center">
          <h2 class="mb-4 fw-bold text-primary">
            Draw the numbers 0 to 9 to predict
          </h2>
          <form id="imageForm" action="/show_result_num/" method="POST">
            {% csrf_token %}
            <input type="hidden" name="image" id="imageInput" />
            <canvas
              id="canvas"
              width="420"
              height="420"
              class="rounded shadow"
            ></canvas>
            <br />

            <div class="mt-4">
              <button
                type="button"
                class="btn btn-danger me-2"
                onclick="clearCanvas()"
              >
                üßπ Clear
              </button>
              <button type="submit" class="btn btn-success me-2">
                üì§ Send
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  let isDrawing = false;

  canvas.addEventListener("mousedown", () => (isDrawing = true));
  canvas.addEventListener("mouseup", () => (isDrawing = false));
  canvas.addEventListener("mousemove", draw);

  function draw(event) {
    if (!isDrawing) return;
    ctx.fillStyle = "white";
    ctx.fillRect(event.offsetX, event.offsetY, 15, 15);
  }

  function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  document
    .getElementById("imageForm")
    .addEventListener("submit", function (event) {
      event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

      const imageData = canvas.toDataURL("image/png");

      const canvasResized = document.createElement("canvas");
      const ctxResized = canvasResized.getContext("2d");
      canvasResized.width = 28;
      canvasResized.height = 28;
      const img = new Image();
      img.src = imageData;

      img.onload = function () {
        ctxResized.drawImage(img, 0, 0, 28, 28);
        document.getElementById("imageInput").value =
          canvasResized.toDataURL("image/png");
        document.getElementById("imageForm").submit(); // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend
      };
    });
</script>

{% endblock %}
